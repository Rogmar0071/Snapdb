<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<title>SnapDB</title>

<style>
body{
  font-family:system-ui;
  margin:0;
  background:#e2e6ea;
}

.chat{
  padding:14px;
  padding-bottom:120px;
}

.card{
  background:white;
  padding:12px;
  border-radius:16px;
  margin-bottom:10px;
}

.composer{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#e2e6ea;
  padding:10px;
  display:flex;
  gap:8px;
}

input{
  flex:1;
  border-radius:20px;
  padding:10px;
  border:none;
}

button{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:#4f7ee8;
  color:white;
}
</style>
</head>

<body>

<div class="chat" id="chat"></div>

<div class="composer">
  <button id="mic">ðŸŽ¤</button>
  <input id="msg" placeholder="Type or speak...">
  <button id="send">âž¤</button>
</div>

<script src="engine.js"></script>
<script src="assistant.js"></script>

<script>
const chat = document.getElementById('chat');
const input = document.getElementById('msg');
const send = document.getElementById('send');

function bubble(text){
  const div = document.createElement('div');
  div.className = 'card';
  div.textContent = text;
  chat.appendChild(div);
}

function refresh(){

  const s = SnapEngine.rebuild();

  document.getElementById("stats")?.remove();

  const d = document.createElement('div');
  d.id="stats";
  d.className='card';
  d.innerHTML = `
  Stock: ${s.stock}<br>
  Cash: R${s.cash}<br>
  Orders: ${s.orders}
  `;

  chat.prepend(d);
}

send.onclick = () => {

  const text = input.value;
  if(!text) return;

  bubble(text);

  const event = SnapAssistant.parse(text);

  if(event){
    SnapEngine.append(event);
  }

  input.value="";
  refresh();
}

refresh();
</script>

</body>
</html>
